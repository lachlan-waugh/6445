<!doctype html><html lang=en><head><meta charset=utf-8><title>07: memory forensics</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1905>We&rsquo;ll get started at 19:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=memory-forensics>memory forensics</h1><h3 id=comp6445-week07>comp6445 week07</h3></section><section><h3 id=house-keeping>house keeping</h3><p><img src=https://thumbs.gfycat.com/FriendlyWarmLark-max-1mb.gif alt></p><ul><li>investigation</li><li>report feedback</li></ul></section><section><section data-shortcode-section><h3 id=investigation>investigation</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>device last used</td><td>27/07/2021 (check the timeline feature in autopsy)</td></tr><tr><td>file system used</td><td>HFS+ (check the partition table)</td></tr><tr><td>who owns device</td><td>Joan Sally Smith (bunch of stuff in the user account directory)</td></tr><tr><td>are you certain</td><td>no (you can never be)</td></tr><tr><td>fs version</td><td>HFS+ 4 (volume header section contains HFSPlusVolumeHeader)</td></tr></tbody></table></section><section><h3 id=harder-questions>harder questions</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>user&rsquo;s password</td><td>PaSsWoRd (crack the keychain with <a href=https://int0x33.medium.com/day-68-crack-file-key-and-keychain-passwords-with-john-8aeb5df34a54>johntheripper</a>)</td></tr><tr><td>hidden passwords</td><td>bobbytables (header of /&mldr;/Document/agocbaqa0h341)</td></tr><tr><td></td><td>correcthorsebatterystaple (in the file /&mldr;/Document/gpj.10mhk4pc3paw0)</td></tr><tr><td>secrets in keychain</td><td>SuperSecret:IShouldBeUsingMFAIn2021 (<a href=https://github.com/n0fate/chainbreaker>chainbreaker</a> with user&rsquo;s password)</td></tr></tbody></table></section></section><section><section data-shortcode-section><h2 id=report-feedback>report feedback</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Report AVG</td><td><code>74.85%</code></td></tr><tr><td>Reflection AVG</td><td><code>61.88%</code></td></tr><tr><td>Overall</td><td><code>71.11%</code></td></tr></tbody></table></section><section><h3 id=findings>findings</h3><p>84%</p><ul><li>Terry editing receipts</li><li>Terry selling customer equipment</li><li>Charlie extorting SWExpert</li><li>Charlie selling secrets to project2400</li></ul></section><section><h3 id=additional-findings>additional findings</h3><p>You had to find one of the following</p><ul><li>CCleaner</li><li>Terry&rsquo;s keylogger</li><li>Cygnus hex editor</li><li>Prefetch files for the image editor</li></ul></section><section><h3 id=style>style</h3><p>78%</p><p>Just a checklist</p><ul><li>Qualifications of the investigator</li><li>Declaration</li><li>Hashes of the files</li><li>Instructions provided</li><li>Tools used (with versions)</li></ul></section><section><h3 id=explaining-the-evidence>explaining the evidence</h3><p>74%</p><ul><li>If you mention something, explain it<ul><li>e.g. a tool: what is autopsy, what does it do??</li><li>e.g. a concept: what is a hash, or hex??!?</li></ul></li><li>A layperson should be able to understand the report (e.g. the jury, a judge, etc)</li><li>Don&rsquo;t make assumptions before you give evidence</li><li>Explain your findings, don&rsquo;t make conclusions until the end</li></ul></section><section><h3 id=screenshots>screenshots</h3><p>72%</p><ul><li>some people didn&rsquo;t include any, which is brave</li><li>if there&rsquo;s something important in the screenshot, highlight it</li><li>include screenshots in the investigation section, not just the appendix</li><li>the images should link to what you&rsquo;re talking about</li><li>if you&rsquo;re attaching images, or files, include their hashes, locations, paths, etc</li></ul></section><section><h3 id=structure>structure</h3><p>68%</p><ul><li>separate different &ldquo;findings&rdquo; into sections, don&rsquo;t just have everything in one big blob</li><li>label things: number each paragraph/attachment so you can reference them later</li><li>tables are fantastic & make it really easy to follow</li><li>make my viewing experience pleasurable pls and ty</li></ul></section><section><h3 id=conclusion>conclusion</h3><p>57%</p><ul><li><strong>reference the specific evidence in your conclusion</strong></li><li><strong>actually answer the question from the instructions</strong></li><li>really important, it shouldn&rsquo;t be 50 words.</li><li>You should be giving your opinion on what you think happened, don&rsquo;t necessarily place blame (unless you can be sure a certain party did it)</li></ul></section><section><h3 id=reflection-part-a>reflection part a</h3><p>68%</p><ul><li>The evidence asked for was generally okay, but the justifications for it were generally a bit weak</li><li>what would you do with the evidence</li><li>how would this evidence strengthen your case?</li><li>be specific!</li></ul></section><section><h3 id=reflection-part-b>reflection part b</h3><p>55%</p><ul><li>the questions should be questioning the integrity of the report, not you as a person</li><li>don&rsquo;t give a soft-ball questions &ldquo;damn why this report so good&rdquo;, you should be attacking your report, findings holes in it</li><li>reference things discussed in the lectures (only using one tool, lack of evidence)</li></ul></section><section><h3 id=overall>overall</h3><blockquote><p>the report should be a story</p></blockquote></section><section><h3 id=walkthrough>walkthrough</h3><blockquote><p>anyone want to volunteer?</p></blockquote></section></section><section><h2 id=discussion>discussion</h2><ul><li>any questions about the second report?</li><li>if not, anyone want to play gartic phone?</li></ul></section><section><section data-shortcode-section><h3 id=memory-forensics>memory forensics</h3></section><section><h3 id=what-is-it>what is it?</h3><ul><li>investigating a dump of the RAM from a computer system</li></ul></section><section><h3 id=when-is-this-useful>when is this useful</h3><blockquote><p>when?</p></blockquote></section><section><h3 id=when-is-this-useful-1>when is this useful</h3><ul><li><p>there&rsquo;s a lot you can&rsquo;t get from a harddisk image</p><ul><li>if/when a program was executed</li><li>how it was executed (arguments, lifespan)</li></ul></li><li><p>some malware never touches the disk</p></li></ul></section><section><h3 id=fileless-malware>fileless malware</h3><ul><li>even if it never touches disk, at some point, it has to be in memory</li><li>process hollowing: when a legitimate process is paused, duplicated, and then it&rsquo;s executable memory is replaced with malicious code</li><li>this can bypass simple AVs which ignore whitelisted/trusted services</li></ul><blockquote><p>read more <a href=https://www.trellix.com/en-au/security-awareness/ransomware/what-is-fileless-malware.html>here</a> and <a href=https://www.crowdstrike.com/cybersecurity-101/malware/fileless-malware/>here</a></p></blockquote></section><section><p><img src=../assets/img/week05/inmemory-malware.png alt></p></section><section><h3 id=what-could-you-find-in-memory>what could you find in memory?</h3><blockquote><p>what</p></blockquote></section><section><h3 id=what-could-you-find-in-memory-1>what could you find in memory?</h3><ul><li>recently executed commands</li><li>running processes, and their code/DLLs</li><li>drivers & daemons</li><li>passwords, security keys, security information</li></ul></section></section><section><section data-shortcode-section><h3 id=collecting-memory-dumps>collecting memory dumps</h3><ul><li>RAM is volatile, you can&rsquo;t capture it after the computer is shutdown</li><li>It can be hard to collect when it&rsquo;s live (you don&rsquo;t want to change the machines state)</li></ul></section><section><h3 id=when-could-collecting-memory-be-difficult>when could collecting memory be difficult?</h3><ul><li>if the data is stored in a datacenter/cloud provider<ul><li>how would you collect it?</li></ul></li></ul></section></section><section><h3 id=what-processes-are-sus-ඞ>what processes are sus ඞ</h3><p><span class=fragment><p>obfuscate names/paths (drop some malware in a system location and give it a legitimate name)</p></span><span class=fragment><p>misspelled versions of proper system processes</p></span><span class=fragment><p>proper system names in wrong location</p></span><span class=fragment><p>duplicate processes that should only spawn once</p></span><span class=fragment><p>processes that have a parent they shouldn’t</p></span><span class=fragment><p>system processes with start time much later in life</p></span><span class=fragment><p>system processes running under a user account</p></span></p></section><section><section data-shortcode-section><h3 id=volatility>volatility</h3><blockquote><p>cause RAM is volatile lol</p></blockquote></section><section><h3 id=list-all-the-processes>list all the processes</h3><ul><li><code>windows.pstree</code><ul><li>get processes tree (not hidden)</li></ul></li><li><code>windows.pslist</code><ul><li>get process list (EPROCESS)</li></ul></li><li><code>windows.psscan</code><ul><li>get hidden process list (e.g. malware)</li></ul></li></ul></section><section><h3 id=dumping-a-process>dumping a process</h3><ul><li><code>windows.dumpfiles --pid &lt;PID></code><ul><li>get the executable & DLLs</li></ul></li><li><code>windows.memmap --dump --pid &lt;PID></code><ul><li>get all memory resident pages</li></ul></li><li><code>windows.dllist --pid &lt;PID></code><ul><li>list the DLLs used by a process</li></ul></li></ul></section><section><h3 id=see-how-a-process-was-started>see how a process was started</h3><ul><li><code>windows.cmdline</code><ul><li>shows the arguments used for the process</li></ul></li><li><code>windows.envars [--pid &lt;pid>]</code><ul><li>display process environment variables</li></ul></li><li><code>windows.handles --pid &lt;pid></code><ul><li>show files, threads, etc a process has opened</li></ul></li></ul></section><section><h3 id=registries>registries</h3><ul><li><code>windows.registry.hivescan</code><ul><li>TODO</li></ul></li><li><code>windows.registry.hivelist</code><ul><li>TODO</li></ul></li><li><code>windows.registry.printkey -K "Path\To\Key"</code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=viewing-files>viewing files</h3><ul><li><code>windows.filescan</code><ul><li>TODO</li></ul></li><li><code>windows.dumpfiles</code><ul><li>TODO</li></ul></li><li><code>windows.dumpfiles --virtaddr &lt;o></code><ul><li>TODO</li></ul></li><li><code>windows.dumpfiles --physaddr &lt;o></code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=networking>networking</h3><ul><li><code>windows.netscan</code><ul><li>TODO</li></ul></li><li><code>windows.netstat</code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=pattern-match-strings>pattern match strings</h3><ul><li><code>windows.strings --strings-file ./strings_file</code><ul><li>TODO</li></ul></li><li><code>windows.vadyarascan --yara-rules "https://" --pid &lt;PIDS></code><ul><li>TODO</li></ul></li><li><code>yarascan.YaraScan --yara-rules &lt;R></code><ul><li>TODO</li></ul></li></ul></section><section><h3 id=dumping-hashes>dumping hashes</h3><ul><li><code>windows.hashdump</code><ul><li>grab common windows hashes (SAM+SYSTEM)</li></ul></li><li><code>windows.cachedump</code><ul><li>grab domain cache hashes inside the registry</li></ul></li><li><code>windows.lsadump</code><ul><li>grab lsa secrets</li></ul></li></ul></section><section><h3 id=reference-list>reference list</h3><ul><li>command list can be found <a href=https://github.com/volatilityfoundation/volatility/wiki/Command-Reference>here</a></li><li>some other <a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/memory-dump-analysis/volatility-cheatsheet>stuff</a></li></ul></section></section><section><h2 id=demo>Demo</h2><p>another stolen <a href=https://mega.nz/#!sh8wmCIL!b4tpech4wzc3QQ6YgQ2uZnOmctRZ2duQxDqxbkWYipQ>challenge</a></p><blockquote><p>can you find Rick&rsquo;s password?</p></blockquote></section><section><h2 id=tutorial>Tutorial</h2><blockquote><p>finally, another investigation</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>